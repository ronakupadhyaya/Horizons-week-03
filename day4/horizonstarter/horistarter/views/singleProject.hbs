<body>
    <h1>{{project.title}}</h1>
<h3>Category: {{project.category}}</h3>
<h3>Fundraising goal: $<span id="goal">{{project.goal}}</span></h3>
<h3>Total contributions: $<span id="raised">{{project.raised}}</span></h3>
<div class="progress">
    <div class="progress-bar" role="progressbar" style="width:{{project.percent}}% ;min-width: 2em;">
      <span id="progress">{{project.percent}}</span>%
    </div>
</div>
<h3>Start date: {{project.startDate}}</h3>
<h3>End date: {{project.endDate}}</h3>
<h3>About this project:</h3>
<p>{{project.description}}</p>
<h3>Contributions:</h3>
<div id="contributions">
	{{#each project.contributions}}
    <div class="well">
        <h4>{{name}} contributed ${{amount}}</h4>
        <p>{{comment}}</p>
    </div>
    {{/each}}
</div>
<h3 >Contribute to this project:</h3>
<form id="contribForm" method="post">
    <div class="form-group">
        <input type="text" name="name" class="form-control" id="name" placeholder="Your Name" value="">
    </div>
    <div class="form-group">
        <input type="text" name="comment" class="form-control" id="comment" placeholder="Comment" value="">
    </div>
    <div class="form-group">
        <div class="input-group">
            <div class="input-group-addon">$</div>
            <input type="text" class="form-control" id="amount" name="amount" placeholder="Amount" value="">
            <div class="input-group-addon">.00</div>
        </div>
    </div>
    <button type="submit" class="btn btn-primary">Contribute</button>
</form>
<br>
<a href="/">Back to all projects</a>

<script>

$('#contribForm').on('submit', function(e) {
    
    e.preventDefault();
    var target = $(e.target);
    var inputs = target.find('input');
    var contrib = {};
    inputs.each(function(i, inputElement) {
        var val = $(inputElement).val();
        var name = $(inputElement).attr('name');
        contrib[name] = val;
    });
    $.ajax('/api/project/{{project._id}}/contribute', {
        method: 'post',
        data: contrib,
        success: function(data) {
            
           var raised = parseInt($('#raised').text());
           raised += parseInt(contrib.amount);
           $('#raised').text(raised);

           var goal = parseInt($('#goal').text());
           var progress = Math.round(raised/ goal * 100);
           $('#progress').text(progress);
           $('.progress-bar').css('width', '' + progress + '%');

           var outerDiv = $('<div class="well">');
           outerDiv.append($('<h4>').text(
            contrib.name + 'contributed $' + contrib.amount));
           if (contrib.comment) {
            outerDiv.append($('<p>').text(contrib.comment));
           }
           $('#contributions').append(outerDiv);
        }
    });
});

</script>

  

</body>